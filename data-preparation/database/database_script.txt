-- 1. Document Metadata (PDFs, News Articles)
CREATE TABLE documents (
  doc_id TEXT PRIMARY KEY,          -- Unique ID (e.g., "B2", "B3")
  doc_type TEXT NOT NULL,           -- 'pdf' or 'news'
  raw_content TEXT NOT NULL,        -- Full extracted text
  cluster_id INTEGER                -- Associated concept cluster
);

-- 2. Fraud Concept Clusters
CREATE TABLE clusters (
  cluster_id SERIAL PRIMARY KEY,
  cluster_name TEXT NOT NULL UNIQUE, -- e.g., "Vendor Collusion"
  description TEXT                   -- Context: "Collusion between Vendor 1/2 in airport tenders"
);

-- 3. Entities (Vendors, Tenders, Persons, Organizations)
CREATE TABLE entities (
  entity_id TEXT PRIMARY KEY,       -- "Vendor_1", "ITF", "Case_286/04"
  entity_type TEXT NOT NULL,        -- Vendor|Tender|Person|Organization|Case
  attributes JSONB NOT NULL DEFAULT '{}', -- {existence: false, role: "owner", ...}
  sources TEXT[] NOT NULL           -- Document IDs mentioning this entity
);

-- 4. Relationships Between Entities
CREATE TABLE relationships (
  relationship_id SERIAL PRIMARY KEY,
  source_id TEXT NOT NULL REFERENCES entities(entity_id),
  target_id TEXT NOT NULL REFERENCES entities(entity_id),
  label TEXT NOT NULL,              -- 'owns', 'submitted_bid', 'investigated'
  attributes JSONB,                 -- {amount: "â‚¬15,919", date: "2003-01-01"}
  sources TEXT[] NOT NULL           -- Document IDs mentioning this relationship
);

-- 5. Entity-Cluster Mapping
CREATE TABLE entity_clusters (
  entity_id TEXT REFERENCES entities(entity_id),
  cluster_id INTEGER REFERENCES clusters(cluster_id),
  PRIMARY KEY (entity_id, cluster_id)
);

-- Indexes for Fast Queries
CREATE INDEX idx_entities_type ON entities(entity_type);
CREATE INDEX idx_relationships_label ON relationships(label);
